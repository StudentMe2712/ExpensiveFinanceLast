const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();

// –¢–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤
const CLIENT_BOT_TOKEN = process.env.TELEGRAM_CLIENT_BOT_TOKEN || '7062627252:AAHhocIpcumSYXFne2Qjrf6ZZJhmHdmdEJI';
const MAIN_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN || '7062627252:AAHhocIpcumSYXFne2Qjrf6ZZJhmHdmdEJI';

// –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º —è–∑—ã–∫–µ
const kazakhMessages = [
  '–°”ô–ª–µ–º! –ù–µ—Å–∏–µ –∞–ª—É“ì–∞ –∫”©–º–µ–∫ –∫–µ—Ä–µ–∫',
  '–ú–µ–Ω—ñ“£ –Ω–µ—Å–∏–µ —Ç–∞—Ä–∏—Ö—ã–º –Ω–∞—à–∞—Ä, –∫”©–º–µ–∫—Ç–µ—Å–µ –∞–ª–∞—Å—ã–∑ –±–∞?',
  '“ö–∞–Ω–¥–∞–π “õ“±–∂–∞—Ç—Ç–∞—Ä “õ–∞–∂–µ—Ç?',
  '–ú–∏–Ω–∏–º–∞–ª–¥—ã —Å–æ–º–∞ “õ–∞–Ω—à–∞?',
  '“ö–∞–Ω—à–∞ —É–∞“õ—ã—Ç—Ç–∞ –º–∞“õ“±–ª–¥–∞—É –∞–ª–∞–º—ã–Ω?',
  '–ö–æ–º–∏—Å—Å–∏—è “õ–∞–Ω—à–∞?',
  '–ë–∞–Ω–∫—Ç–µ—Ä–º–µ–Ω –∂“±–º—ã—Å —ñ—Å—Ç–µ–π—Å—ñ–∑ –±–µ?',
  '–¢–µ–≥—ñ–Ω –∫–µ“£–µ—Å –±–µ—Ä–µ—Å—ñ–∑ –±–µ?',
  '”®—Ç—ñ–Ω—ñ—à “õ–∞–ª–∞–π “õ–∞–ª–¥—ã—Ä—É“ì–∞ –±–æ–ª–∞–¥—ã?',
  '–°—ñ–∑–¥—ñ“£ —Ç”ô–∂—ñ—Ä–∏–±–µ“£—ñ–∑ “õ–∞–Ω—à–∞ –∂—ã–ª?'
];

// –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
const russianMessages = [
  '–ü—Ä–∏–≤–µ—Ç! –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∫—Ä–µ–¥–∏—Ç–∞',
  '–£ –º–µ–Ω—è –ø–ª–æ—Ö–∞—è –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, –º–æ–∂–µ—Ç–µ –ø–æ–º–æ—á—å?',
  '–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã?',
  '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–∫–æ–ª—å–∫–æ?',
  '–ó–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—É—á—É –æ–¥–æ–±—Ä–µ–Ω–∏–µ?',
  '–°–∫–æ–ª—å–∫–æ –∫–æ–º–∏—Å—Å–∏—è?',
  '–†–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±–∞–Ω–∫–∞–º–∏?',
  '–î–∞–µ—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏?',
  '–ö–∞–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É?',
  '–°–∫–æ–ª—å–∫–æ –ª–µ—Ç –≤–∞—à –æ–ø—ã—Ç?'
];

async function testBotWithMessages(botToken, botName, messages) {
  console.log(`\nü§ñ –¢–µ—Å—Ç–∏—Ä—É–µ–º ${botName}...`);
  
  try {
    const bot = new TelegramBot(botToken, { polling: false });
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
    const botInfo = await bot.getMe();
    console.log(`‚úÖ –ë–æ—Ç ${botName} –ø–æ–¥–∫–ª—é—á–µ–Ω: @${botInfo.username}`);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–æ—Ç –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    console.log(`üìù –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π`);
    
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∑–∞—Ö—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
    console.log(`üî§ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∞–∑–∞—Ö—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤:`);
    
    for (let i = 0; i < Math.min(3, messages.length); i++) {
      const message = messages[i];
      console.log(`   üì§ –°–æ–æ–±—â–µ–Ω–∏–µ ${i + 1}: "${message}"`);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∑–∞—Ö—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã
      const hasKazakhChars = /[”ô“ì“õ“£”©“±“Ø—ñ“ª]/.test(message);
      if (hasKazakhChars) {
        console.log(`   ‚úÖ –ö–∞–∑–∞—Ö—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è`);
      } else {
        console.log(`   ‚ÑπÔ∏è  –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ`);
      }
    }
    
    bot.stopPolling();
    return true;
    
  } catch (error) {
    console.log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ ${botName}:`, error.message);
    return false;
  }
}

async function runTests() {
  console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ —è–∑—ã–∫–∞...\n');
  
  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç
  const clientBotSuccess = await testBotWithMessages(
    CLIENT_BOT_TOKEN, 
    '–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç', 
    kazakhMessages
  );
  
  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
  const mainBotSuccess = await testBotWithMessages(
    MAIN_BOT_TOKEN, 
    '–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç', 
    kazakhMessages
  );
  
  console.log('\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
  console.log(`ü§ñ –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç: ${clientBotSuccess ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –û—à–∏–±–∫–∞'}`);
  console.log(`ü§ñ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: ${mainBotSuccess ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –û—à–∏–±–∫–∞'}`);
  
  if (clientBotSuccess && mainBotSuccess) {
    console.log('\nüéâ –í—Å–µ –±–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
    console.log('‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∑–∞—Ö—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
    console.log('‚úÖ –ë–æ—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ —Å –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏');
  } else {
    console.log('\n‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –±–æ—Ç–∞–º–∏');
    console.log('üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —Ç–æ–∫–µ–Ω—ã');
  }
  
  console.log('\nüìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:');
  console.log('‚Ä¢ –ë–æ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤');
  console.log('‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º —è–∑—ã–∫–µ');
  console.log('‚Ä¢ –ë–æ—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫–∞–∑–∞—Ö—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã');
  console.log('‚Ä¢ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —è–∑—ã–∫–∞ –≤–≤–æ–¥–∞');
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
runTests().catch(console.error);
