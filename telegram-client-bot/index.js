const TelegramBot = require('node-telegram-bot-api');
const axios = require('axios');

// ะะพะฝัะธะณััะฐัะธั
const CLIENT_BOT_TOKEN = process.env.TELEGRAM_CLIENT_BOT_TOKEN || 'YOUR_CLIENT_BOT_TOKEN_HERE';
const WEBSITE_URL = process.env.WEBSITE_URL || 'https://expensive-finance.vercel.app';
const ADMIN_CHAT_ID = process.env.TELEGRAM_CHAT_ID || '-1002971250513'; // ะััะฟะฟะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน

// ะกะพะทะดะฐะฝะธะต ะบะปะธะตะฝััะบะพะณะพ ะฑะพัะฐ
const clientBot = new TelegramBot(CLIENT_BOT_TOKEN, { polling: true });

// ะกะพััะพัะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
const userStates = new Map();
const userData = new Map();

// ะะปะฐะฒะฝะพะต ะผะตะฝั ะบะปะธะตะฝััะบะพะณะพ ะฑะพัะฐ
const mainMenu = {
  reply_markup: {
    keyboard: [
      ['๐ฐ ะัะตะดะธัั', '๐ฆ ะะตะฟะพะทะธัั'],
      ['๐ ะะฐะปัะบัะปััะพั', '๐ ะกะฒัะทะฐัััั ั ะผะตะฝะตะดะถะตัะพะผ'],
      ['โน๏ธ ะ ะบะพะผะฟะฐะฝะธะธ', '๐ ะะฐั ัะฐะนั']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// ะัะตะดะธัะฝะพะต ะผะตะฝั
const creditMenu = {
  reply_markup: {
    keyboard: [
      ['๐ ะญะบัะฟัะตัั ะบัะตะดะธั', '๐ ะะฟะพัะตะบะฐ'],
      ['๐ ะะฒัะพะบัะตะดะธั', '๐ผ ะะธะทะฝะตั ะบัะตะดะธั'],
      ['โ ะะฐะดะฐัั ะฒะพะฟัะพั', '๐ ะะฐะทะฐะด ะฒ ะผะตะฝั']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// ะะตะฟะพะทะธัะฝะพะต ะผะตะฝั
const depositMenu = {
  reply_markup: {
    keyboard: [
      ['๐ ะะฐัะผะตั ะดะตะฟะพะทะธั', '๐ ะัะตะผะธัะผ ะดะตะฟะพะทะธั'],
      ['๐ ะกัะพัะฝัะน ะดะตะฟะพะทะธั', '๐ ะะพะฟะพะปะฝัะตะผัะน'],
      ['โ ะะฐะดะฐัั ะฒะพะฟัะพั', '๐ ะะฐะทะฐะด ะฒ ะผะตะฝั']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// ะะตะฝั ะฒะพะฟัะพัะพะฒ
const questionMenu = {
  reply_markup: {
    keyboard: [
      ['๐ ะะพะดะฐัั ะทะฐัะฒะบั', '๐ ะะพะทะฒะพะฝะธัั'],
      ['๐ฌ WhatsApp', '๐ ะะฐะทะฐะด ะฒ ะผะตะฝั']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// ะะฑัะฐะฑะพัะบะฐ ะบะพะผะฐะฝะดั /start
clientBot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name;
  const userId = msg.from.id;
  
  // ะกะพััะฐะฝัะตะผ ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
  userData.set(userId, {
    firstName: firstName,
    username: msg.from.username,
    chatId: chatId,
    joinedAt: new Date()
  });
  
  const welcomeMessage = `
๐ ะัะธะฒะตั, ${firstName}!

ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ Expensive Finance! 
ะฏ ะฒะฐั ะฟะตััะพะฝะฐะปัะฝัะน ะฟะพะผะพัะฝะธะบ ะฟะพ ัะธะฝะฐะฝัะพะฒัะผ ะฒะพะฟัะพัะฐะผ.

๐ก ะงัะพ ั ะผะพะณั ะดะปั ะฒะฐั ัะดะตะปะฐัั:
โข ๐ ะะฐััะบะฐะทะฐัั ะพ ะฝะฐัะธั ััะปัะณะฐั
โข ๐งฎ ะะพะผะพัั ัะฐัััะธัะฐัั ะบัะตะดะธั
โข ๐ ะกะฒัะทะฐัั ั ะผะตะฝะตะดะถะตัะพะผ
โข โ ะัะฒะตัะธัั ะฝะฐ ะฒะฐัะธ ะฒะพะฟัะพัั

ะัะฑะตัะธัะต ะธะฝัะตัะตััััะธะน ะฒะฐั ัะฐะทะดะตะป:
  `;
  
  clientBot.sendMessage(chatId, welcomeMessage, mainMenu);
  
  // ะฃะฒะตะดะพะผะปัะตะผ ะฐะดะผะธะฝะธัััะฐัะพัะพะฒ ะพ ะฝะพะฒะพะผ ะฟะพะปัะทะพะฒะฐัะตะปะต
  notifyAdmins(`๐ ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฑะพัะฐ:\n๐ค ${firstName} (@${msg.from.username || 'ะฑะตะท username'})\n๐ ID: ${userId}`);
});

// ะะฑัะฐะฑะพัะบะฐ ัะตะบััะพะฒัั ัะพะพะฑัะตะฝะธะน
clientBot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  const userId = msg.from.id;
  
  // ะกะพััะฐะฝัะตะผ ัะพััะพัะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
  if (!userStates.has(userId)) {
    userStates.set(userId, 'main');
  }
  
  const userState = userStates.get(userId);
  const user = userData.get(userId);
  
  switch (text) {
    case '๐ฐ ะัะตะดะธัั':
      userStates.set(userId, 'credits');
      clientBot.sendMessage(chatId, 
        `๐ณ ะะฐัะธ ะบัะตะดะธัะฝัะต ะฟัะพะดัะบัั:\n\nะัะฑะตัะธัะต ะธะฝัะตัะตััััะธะน ะฒะฐั ัะธะฟ ะบัะตะดะธัะฐ ะดะปั ะฟะพะปััะตะฝะธั ะฟะพะดัะพะฑะฝะพะน ะธะฝัะพัะผะฐัะธะธ:`,
        creditMenu
      );
      break;
      
    case '๐ฆ ะะตะฟะพะทะธัั':
      userStates.set(userId, 'deposits');
      clientBot.sendMessage(chatId, 
        `๐ฆ ะะฐัะธ ะดะตะฟะพะทะธัะฝัะต ะฟัะพะดัะบัั:\n\nะัะฑะตัะธัะต ะธะฝัะตัะตััััะธะน ะฒะฐั ัะธะฟ ะดะตะฟะพะทะธัะฐ ะดะปั ะฟะพะปััะตะฝะธั ะฟะพะดัะพะฑะฝะพะน ะธะฝัะพัะผะฐัะธะธ:`,
        depositMenu
      );
      break;
      
    case '๐ ะะฐะปัะบัะปััะพั':
      clientBot.sendMessage(chatId, 
        `๐งฎ ะัะตะดะธัะฝัะน ะบะฐะปัะบัะปััะพั:\n\nะะปั ัะพัะฝะพะณะพ ัะฐััะตัะฐ ะฒะฐัะตะณะพ ะบัะตะดะธัะฐ ะฟะตัะตะนะดะธัะต ะฝะฐ ะฝะฐั ัะฐะนั. ะขะฐะผ ะฒั ะฝะฐะนะดะตัะต ัะดะพะฑะฝัะน ะบะฐะปัะบัะปััะพั ั ะธะฝัะตัะฐะบัะธะฒะฝัะผะธ ัะปะฐะนะดะตัะฐะผะธ!\n\n๐ ะกััะปะบะฐ: ${WEBSITE_URL}/#credit-calculator`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐งฎ ะัะบัััั ะบะฐะปัะบัะปััะพั', url: `${WEBSITE_URL}/#credit-calculator` }
            ]]
          }
        }
      );
      break;
      
    case '๐ ะกะฒัะทะฐัััั ั ะผะตะฝะตะดะถะตัะพะผ':
      userStates.set(userId, 'contact');
      clientBot.sendMessage(chatId, 
        `๐ ะกะฒัะทั ั ะผะตะฝะตะดะถะตัะพะผ:\n\nะัะฑะตัะธัะต ัะดะพะฑะฝัะน ัะฟะพัะพะฑ ัะฒัะทะธ:\n\n๐ฑ ะขะตะปะตัะพะฝ: +7 (777) 123-45-67\n๐ฌ WhatsApp: +7 (777) 123-45-67\n๐ง Email: info@expensive-finance.com\n\n๐ ะะฐะฑะพัะฐะตะผ: 9:00 - 21:00 (ะตะถะตะดะฝะตะฒะฝะพ)`,
        questionMenu
      );
      break;
      
    case 'โน๏ธ ะ ะบะพะผะฟะฐะฝะธะธ':
      clientBot.sendMessage(chatId, 
        `๐ข ะ ะบะพะผะฟะฐะฝะธะธ Expensive Finance:\n\nโ ะะธัะตะฝะทะธัะพะฒะฐะฝะฝะฐั ัะธะฝะฐะฝัะพะฒะฐั ะพัะณะฐะฝะธะทะฐัะธั\nโ ะะฐะฑะพัะฐะตะผ ั 2018 ะณะพะดะฐ\nโ ะะพะปะตะต 10,000 ะดะพะฒะพะปัะฝัั ะบะปะธะตะฝัะพะฒ\nโ ะะดะพะฑัะตะฝะธะต ะบัะตะดะธัะฐ ะทะฐ 24 ัะฐัะฐ\nโ ะะฝะดะธะฒะธะดัะฐะปัะฝัะน ะฟะพะดัะพะด ะบ ะบะฐะถะดะพะผั ะบะปะธะตะฝัั\n\n๐ฏ ะะฐัะฐ ะผะธััะธั - ะฟะพะผะพัั ะบะฐะถะดะพะผั ะฟะพะปััะธัั ะฝะตะพะฑัะพะดะธะผัะต ัะธะฝะฐะฝัะพะฒัะต ััะปัะณะธ!\n\n๐ ะะพะดัะพะฑะฝะตะต: ${WEBSITE_URL}/about`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐ ะะพะดัะพะฑะฝะตะต ะฝะฐ ัะฐะนัะต', url: `${WEBSITE_URL}/about` }
            ]]
          }
        }
      );
      break;
      
    case '๐ ะะฐั ัะฐะนั':
      clientBot.sendMessage(chatId, 
        `๐ ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฝะฐ ะฝะฐั ัะฐะนั!\n\nะขะฐะผ ะฒั ะฝะฐะนะดะตัะต:\nโข ๐ ะัะตะดะธัะฝัะน ะบะฐะปัะบัะปััะพั\nโข ๐ ะะฝะปะฐะนะฝ ะทะฐัะฒะบะธ\nโข ๐ ะะบััะฐะปัะฝัะต ััะฐะฒะบะธ\nโข ๐ ะะพะฝัะฐะบัะฝัั ะธะฝัะพัะผะฐัะธั\nโข ๐ก ะะพะปะตะทะฝัะต ััะฐััะธ\n\nะะตัะตัะพะดะธัะต ะธ ะธะทััะฐะนัะต ะฝะฐัะธ ััะปัะณะธ!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐ ะัะบัััั ัะฐะนั', url: WEBSITE_URL }
            ]]
          }
        }
      );
      break;
      
    // ะัะตะดะธัะฝัะต ะฟัะพะดัะบัั
    case '๐ ะญะบัะฟัะตัั ะบัะตะดะธั':
      clientBot.sendMessage(chatId, 
        `๐ ะญะบัะฟัะตัั ะบัะตะดะธั:\n\n๐ฐ ะกัะผะผะฐ: ะดะพ 3,000,000 โธ\nโฐ ะกัะพะบ: ะดะพ 36 ะผะตัััะตะฒ\n๐ ะกัะฐะฒะบะฐ: ะพั 13,10% ะณะพะดะพะฒัั\nโก ะะดะพะฑัะตะฝะธะต: ะทะฐ 24 ัะฐัะฐ\n\nโ ะะตะท ัะฟัะฐะฒะพะบ ะพ ะดะพัะพะดะฐั\nโ ะะฝะปะฐะนะฝ ะทะฐัะฒะบะฐ\nโ ะััััะพะต ัะตัะตะฝะธะต\nโ ะะธะฝะธะผะฐะปัะฝัะน ะฟะฐะบะตั ะดะพะบัะผะตะฝัะพะฒ\n\n๐ก ะฅะพัะธัะต ะฟะพะดะฐัั ะทะฐัะฒะบั ะธะปะธ ะตััั ะฒะพะฟัะพัั?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '๐ ะะพะดะฐัั ะทะฐัะฒะบั', url: `${WEBSITE_URL}/#application` }],
              [{ text: '๐งฎ ะะฐัััะธัะฐัั ะฟะปะฐัะตะถ', url: `${WEBSITE_URL}/#credit-calculator` }],
              [{ text: 'โ ะะฐะดะฐัั ะฒะพะฟัะพั', callback_data: 'ask_question' }]
            ]
          }
        }
      );
      break;
      
    case '๐ ะะฟะพัะตะบะฐ':
      clientBot.sendMessage(chatId, 
        `๐ ะะฟะพัะตัะฝัะน ะบัะตะดะธั:\n\n๐ฐ ะกัะผะผะฐ: ะดะพ 50,000,000 โธ\nโฐ ะกัะพะบ: ะดะพ 25 ะปะตั\n๐ ะกัะฐะฒะบะฐ: ะพั 8,50% ะณะพะดะพะฒัั\n๐ก ะะตัะฒะพะฝะฐัะฐะปัะฝัะน ะฒะทะฝะพั: ะพั 20%\n\nโ ะะธะทะบะฐั ััะฐะฒะบะฐ\nโ ะะพะปะณะพััะพัะฝัะน ะฟะตัะธะพะด\nโ ะะพััะดะฐัััะฒะตะฝะฝะฐั ะฟะพะดะดะตัะถะบะฐ\nโ ะกััะฐัะพะฒะฐะฝะธะต ะฒ ะฟะพะดะฐัะพะบ\nโ ะจะธัะพะบะธะน ะฒัะฑะพั ะฝะตะดะฒะธะถะธะผะพััะธ\n\n๐ก ะะฝัะตัะตััะตั ะธะฟะพัะตะบะฐ?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '๐ ะะพะดะฐัั ะทะฐัะฒะบั', url: `${WEBSITE_URL}/#application` }],
              [{ text: '๐งฎ ะะฐัััะธัะฐัั ะฟะปะฐัะตะถ', url: `${WEBSITE_URL}/#credit-calculator` }],
              [{ text: 'โ ะะฐะดะฐัั ะฒะพะฟัะพั', callback_data: 'ask_question' }]
            ]
          }
        }
      );
      break;
      
    case '๐ ะะฒัะพะบัะตะดะธั':
      clientBot.sendMessage(chatId, 
        `๐ ะะฒัะพะบัะตะดะธั:\n\n๐ฐ ะกัะผะผะฐ: ะดะพ 15,000,000 โธ\nโฐ ะกัะพะบ: ะดะพ 7 ะปะตั\n๐ ะกัะฐะฒะบะฐ: ะพั 9,90% ะณะพะดะพะฒัั\n๐ ะะตะท ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะณะพ ะฒะทะฝะพัะฐ\n\nโ ะััััะพะต ะพัะพัะผะปะตะฝะธะต\nโ ะกััะฐัะพะฒะบะฐ ะฒ ะฟะพะดะฐัะพะบ\nโ ะัะณะพะดะฝัะต ััะปะพะฒะธั\nโ ะจะธัะพะบะธะน ะฒัะฑะพั ะฐะฒัะพ\nโ ะะธะฑะบะธะต ััะปะพะฒะธั ะฟะพะณะฐัะตะฝะธั\n\n๐ก ะะพัะพะฒั ะบัะฟะธัั ะฐะฒัะพะผะพะฑะธะปั?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '๐ ะะพะดะฐัั ะทะฐัะฒะบั', url: `${WEBSITE_URL}/#application` }],
              [{ text: '๐งฎ ะะฐัััะธัะฐัั ะฟะปะฐัะตะถ', url: `${WEBSITE_URL}/#credit-calculator` }],
              [{ text: 'โ ะะฐะดะฐัั ะฒะพะฟัะพั', callback_data: 'ask_question' }]
            ]
          }
        }
      );
      break;
      
    case '๐ผ ะะธะทะฝะตั ะบัะตะดะธั':
      clientBot.sendMessage(chatId, 
        `๐ผ ะัะตะดะธั ะดะปั ะฑะธะทะฝะตัะฐ:\n\n๐ฐ ะกัะผะผะฐ: ะดะพ 100,000,000 โธ\nโฐ ะกัะพะบ: ะดะพ 5 ะปะตั\n๐ ะกัะฐะฒะบะฐ: ะพั 12,50% ะณะพะดะพะฒัั\n๐ผ ะัะณะพัะฝัะน ะฟะตัะธะพะด: ะดะพ 6 ะผะตัััะตะฒ\n\nโ ะะตะท ะทะฐะปะพะณะฐ\nโ ะะฝะดะธะฒะธะดัะฐะปัะฝัะน ะฟะพะดัะพะด\nโ ะััััะพะต ัะตัะตะฝะธะต\nโ ะะธะฑะบะธะต ััะปะพะฒะธั\nโ ะะพะดะดะตัะถะบะฐ ะผะฐะปะพะณะพ ะฑะธะทะฝะตัะฐ\n\n๐ก ะะฐะทะฒะธะฒะฐะนัะต ะฑะธะทะฝะตั ั ะฝะฐะผะธ!`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '๐ ะะพะดะฐัั ะทะฐัะฒะบั', url: `${WEBSITE_URL}/#application` }],
              [{ text: '๐งฎ ะะฐัััะธัะฐัั ะฟะปะฐัะตะถ', url: `${WEBSITE_URL}/#credit-calculator` }],
              [{ text: 'โ ะะฐะดะฐัั ะฒะพะฟัะพั', callback_data: 'ask_question' }]
            ]
          }
        }
      );
      break;
      
    // ะะตะฟะพะทะธัะฝัะต ะฟัะพะดัะบัั
    case '๐ ะะฐัะผะตั ะดะตะฟะพะทะธั':
      clientBot.sendMessage(chatId, 
        `๐ ะะฐัะผะตั ะดะตะฟะพะทะธั:\n\n๐ฐ ะะธะฝะธะผะฐะปัะฝะฐั ััะผะผะฐ: 100,000 โธ\nโฐ ะกัะพะบ: 3, 6, 12 ะผะตัััะตะฒ\n๐ ะกัะฐะฒะบะฐ: ะดะพ 17,80% ะณะพะดะพะฒัั\n๐ ะะพะฟะพะปะฝัะตะผัะน ะดะตะฟะพะทะธั\n\nโ ะััะพะบะธะน ะฟัะพัะตะฝั\nโ ะะธะฑะบะธะต ััะปะพะฒะธั\nโ ะะฐะดะตะถะฝะฐั ะทะฐัะธัะฐ\nโ ะะถะตะผะตัััะฝัะต ะฒัะฟะปะฐัั\nโ ะะพะทะผะพะถะฝะพััั ะฟะพะฟะพะปะฝะตะฝะธั\n\n๐ก ะะฐัะฝะธัะต ะบะพะฟะธัั ัะถะต ัะตะณะพะดะฝั!`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '๐ ะัะบัััั ะดะตะฟะพะทะธั', url: `${WEBSITE_URL}/#application` }],
              [{ text: '๐งฎ ะะฐัััะธัะฐัั ะดะพัะพะด', url: `${WEBSITE_URL}/#credit-calculator` }],
              [{ text: 'โ ะะฐะดะฐัั ะฒะพะฟัะพั', callback_data: 'ask_question' }]
            ]
          }
        }
      );
      break;
      
    case 'โ ะะฐะดะฐัั ะฒะพะฟัะพั':
      userStates.set(userId, 'asking');
      clientBot.sendMessage(chatId, 
        `โ ะะฐะดะฐะนัะต ะฒะฐั ะฒะพะฟัะพั:\n\nะะฐะฟะธัะธัะต ะฒะฐั ะฒะพะฟัะพั, ะธ ั ะฟะตัะตะดะฐะผ ะตะณะพ ะฝะฐัะตะผั ะผะตะฝะตะดะถะตัั. ะั ะพัะฒะตัะธะผ ะฒ ัะตัะตะฝะธะต ัะฐัะฐ!\n\n๐ก ะัะธะผะตัั ะฒะพะฟัะพัะพะฒ:\nโข ะะฐะบะธะต ะดะพะบัะผะตะฝัั ะฝัะถะฝั ะดะปั ะบัะตะดะธัะฐ?\nโข ะะฐะบะพะฒะฐ ะผะธะฝะธะผะฐะปัะฝะฐั ััะผะผะฐ ะดะตะฟะพะทะธัะฐ?\nโข ะะฐะบะธะต ััะปะพะฒะธั ะดะพััะพัะฝะพะณะพ ะฟะพะณะฐัะตะฝะธั?\nโข ะััั ะปะธ ะปัะณะพัั ะดะปั ะฟะตะฝัะธะพะฝะตัะพะฒ?`,
        {
          reply_markup: {
            keyboard: [['๐ ะัะผะตะฝะฐ']],
            resize_keyboard: true,
            one_time_keyboard: true
          }
        }
      );
      break;
      
    case '๐ ะัะผะตะฝะฐ':
      userStates.set(userId, 'main');
      clientBot.sendMessage(chatId, '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั:', mainMenu);
      break;
      
    case '๐ ะะฐะทะฐะด ะฒ ะผะตะฝั':
      userStates.set(userId, 'main');
      clientBot.sendMessage(chatId, '๐ ะะปะฐะฒะฝะพะต ะผะตะฝั:', mainMenu);
      break;
      
    case '๐ ะะพะดะฐัั ะทะฐัะฒะบั':
      clientBot.sendMessage(chatId, 
        `๐ ะะพะดะฐัะฐ ะทะฐัะฒะบะธ:\n\nะะปั ะฟะพะดะฐัะธ ะทะฐัะฒะบะธ ะฟะตัะตะนะดะธัะต ะฝะฐ ะฝะฐั ัะฐะนั. ะขะฐะผ ะฒั ะฝะฐะนะดะตัะต ัะดะพะฑะฝัั ัะพัะผั ั ะฒะฐะปะธะดะฐัะธะตะน ะธ ะฑััััะพะน ะพะฑัะฐะฑะพัะบะพะน.\n\n๐ ะกััะปะบะฐ: ${WEBSITE_URL}/#application`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐ ะะพะดะฐัั ะทะฐัะฒะบั', url: `${WEBSITE_URL}/#application` }
            ]]
          }
        }
      );
      break;
      
    case '๐ ะะพะทะฒะพะฝะธัั':
      clientBot.sendMessage(chatId, 
        `๐ ะะพะทะฒะพะฝะธัั ะฝะฐะผ:\n\n๐ฑ ะขะตะปะตัะพะฝ: +7 (777) 123-45-67\n๐ ะะฐะฑะพัะฐะตะผ: 9:00 - 21:00 (ะตะถะตะดะฝะตะฒะฝะพ)\n\n๐ก ะะฐัะธ ะผะตะฝะตะดะถะตัั ะณะพัะพะฒั ะพัะฒะตัะธัั ะฝะฐ ะฒัะต ะฒะฐัะธ ะฒะพะฟัะพัั!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐ ะะพะทะฒะพะฝะธัั', url: 'tel:+77771234567' }
            ]]
          }
        }
      );
      break;
      
    case '๐ฌ WhatsApp':
      clientBot.sendMessage(chatId, 
        `๐ฌ WhatsApp:\n\nะะฐะฟะธัะธัะต ะฝะฐะผ ะฒ WhatsApp ะดะปั ะฑััััะพะณะพ ะพะฑัะตะฝะธั:\n\n๐ฑ +7 (777) 123-45-67\n\n๐ก ะั ะพัะฒะตัะฐะตะผ ะฒ WhatsApp ะฒ ัะตัะตะฝะธะต 15 ะผะธะฝัั!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: '๐ฌ ะะฐะฟะธัะฐัั ะฒ WhatsApp', url: 'https://wa.me/77771234567?text=ะะดัะฐะฒััะฒัะนัะต! ะะตะฝั ะธะฝัะตัะตัััั ะฒะฐัะธ ัะธะฝะฐะฝัะพะฒัะต ััะปัะณะธ.' }
            ]]
          }
        }
      );
      break;
      
    default:
      // ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ัะตะถะธะผะต ะทะฐะดะฐะฒะฐะฝะธั ะฒะพะฟัะพัะพะฒ
      if (userState === 'asking') {
        // ะะตัะตะดะฐะตะผ ะฒะพะฟัะพั ะผะตะฝะตะดะถะตัะฐะผ
        const questionMessage = `
โ ะะพะฒัะน ะฒะพะฟัะพั ะพั ะบะปะธะตะฝัะฐ:

๐ค ะะปะธะตะฝั: ${user.firstName} (@${user.username || 'ะฑะตะท username'})
๐ ID: ${userId}
๐ฌ ะะพะฟัะพั: ${text}
๐ ะัะตะผั: ${new Date().toLocaleString('ru-RU', { timeZone: 'Asia/Almaty' })}

๐ก ะัะฒะตัััะต ะบะปะธะตะฝัั ะฒ ะปะธัะฝัะต ัะพะพะฑัะตะฝะธั ะธะปะธ ะฟะตัะตะทะฒะพะฝะธัะต.
        `;
        
        notifyAdmins(questionMessage);
        
        clientBot.sendMessage(chatId, 
          `โ ะะฐั ะฒะพะฟัะพั ะฟะพะปััะตะฝ!\n\n๐ฌ ะะพะฟัะพั: "${text}"\n\n๐ ะะฐั ะผะตะฝะตะดะถะตั ะพัะฒะตัะธั ะฒะฐะผ ะฒ ัะตัะตะฝะธะต ัะฐัะฐ.\n\n๐ ะัะตะผั ะฟะพะปััะตะฝะธั: ${new Date().toLocaleString('ru-RU', { timeZone: 'Asia/Almaty' })}`,
          mainMenu
        );
        
        userStates.set(userId, 'main');
      } else {
        // ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐะฟะธัะฐะป ััะพ-ัะพ ะฝะตะพะถะธะดะฐะฝะฝะพะต
        if (userState === 'credits') {
          clientBot.sendMessage(chatId, 'ะัะฑะตัะธัะต ัะธะฟ ะบัะตะดะธัะฐ ะธะท ะผะตะฝั ะฝะธะถะต:', creditMenu);
        } else if (userState === 'deposits') {
          clientBot.sendMessage(chatId, 'ะัะฑะตัะธัะต ัะธะฟ ะดะตะฟะพะทะธัะฐ ะธะท ะผะตะฝั ะฝะธะถะต:', depositMenu);
        } else if (userState === 'contact') {
          clientBot.sendMessage(chatId, 'ะัะฑะตัะธัะต ัะฟะพัะพะฑ ัะฒัะทะธ ะธะท ะผะตะฝั ะฝะธะถะต:', questionMenu);
        } else {
          clientBot.sendMessage(chatId, 
            `๐ค ะะต ะฟะพะฝะธะผะฐั ะฒะฐั ะทะฐะฟัะพั. ะัะฟะพะปัะทัะนัะต ะผะตะฝั ะฝะธะถะต ะธะปะธ ะฝะฐะฟะธัะธัะต /start ะดะปั ะฟะตัะตะทะฐะฟััะบะฐ.\n\n๐ก ะัะปะธ ั ะฒะฐั ะตััั ะฒะพะฟัะพั, ะฝะฐะถะผะธัะต "โ ะะฐะดะฐัั ะฒะพะฟัะพั" ะฒ ะปัะฑะพะผ ัะฐะทะดะตะปะต.`,
            mainMenu
          );
        }
      }
      break;
  }
});

// ะะฑัะฐะฑะพัะบะฐ callback ะทะฐะฟัะพัะพะฒ
clientBot.on('callback_query', (callbackQuery) => {
  const message = callbackQuery.message;
  const chatId = message.chat.id;
  const data = callbackQuery.data;
  
  if (data === 'ask_question') {
    const userId = callbackQuery.from.id;
    userStates.set(userId, 'asking');
    
    clientBot.answerCallbackQuery(callbackQuery.id);
    clientBot.sendMessage(chatId, 
      `โ ะะฐะดะฐะนัะต ะฒะฐั ะฒะพะฟัะพั:\n\nะะฐะฟะธัะธัะต ะฒะฐั ะฒะพะฟัะพั, ะธ ั ะฟะตัะตะดะฐะผ ะตะณะพ ะฝะฐัะตะผั ะผะตะฝะตะดะถะตัั. ะั ะพัะฒะตัะธะผ ะฒ ัะตัะตะฝะธะต ัะฐัะฐ!`,
      {
        reply_markup: {
          keyboard: [['๐ ะัะผะตะฝะฐ']],
          resize_keyboard: true,
          one_time_keyboard: true
        }
      }
    );
  }
});

// ะคัะฝะบัะธั ัะฒะตะดะพะผะปะตะฝะธั ะฐะดะผะธะฝะธัััะฐัะพัะพะฒ
async function notifyAdmins(message) {
  try {
    await clientBot.sendMessage(ADMIN_CHAT_ID, message, { parse_mode: 'HTML' });
  } catch (error) {
    console.error('ะัะธะฑะบะฐ ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธั ะฐะดะผะธะฝะธัััะฐัะพัะฐะผ:', error);
  }
}

// ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
clientBot.on('polling_error', (error) => {
  console.error('Polling error:', error);
});

clientBot.on('error', (error) => {
  console.error('Client Bot error:', error);
});

console.log('๐ค ะะปะธะตะฝััะบะธะน Telegram Bot ะทะฐะฟััะตะฝ ะธ ะณะพัะพะฒ ะบ ัะฐะฑะพัะต!');
console.log('๐ฑ ะะพั: @ExpensiveFinanceClientBot');
console.log('๐ ะกะฐะนั:', WEBSITE_URL);
console.log('๐ฅ ะะดะผะธะฝ ะณััะฟะฟะฐ:', ADMIN_CHAT_ID);

module.exports = clientBot;
